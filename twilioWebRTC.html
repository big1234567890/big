<!DOCTYPE html>
 <html lang="en">
 <head>
     <title>Twilio WebRTC + SIP & Phone</title>
     <script src="https://sdk.twilio.com/js/client/v1.13/twilio.min.js"></script>
 </head>
 <body>
     <h2>Twilio WebRTC + SIP & Phone</h2>
     <p id="status">üîÑ Initializing...</p>
 
     <button id="startButton">Generate Token</button>
     <input type="text" id="callTo" placeholder="Enter Phone Number" />
     <input type="text" id="callTo" placeholder="Enter Phone No." />
     <button onclick="makeCall()">Call</button>
     <button onclick="hangUpCall()">Hang Up</button>
     <button id="answerButton" style="display:none;">Answer</button>
 @@ -34,37 +34,43 @@
         }
 
         async function setupTwilioDevice() {
             const token = await fetchToken();
             if (!token) return;
 
             device = new Twilio.Device(token, {
                 codecPreferences: ["opus", "pcmu"],
                 enableRingingState: true
             });
 
             device.on("ready", () => {
                 console.log("‚úÖ Twilio Device Ready");
                 document.getElementById("status").innerText = "‚úÖ Ready to make/receive calls";
             });
 
             device.on("incoming", (connection) => {
                 console.log("üìû Incoming Call...");
                 document.getElementById("status").innerText = "üìû Incoming Call...";
                 incomingConnection = connection;
 
                 document.getElementById("answerButton").style.display = "inline";
                 document.getElementById("rejectButton").style.display = "inline";
             });
 
             device.on("error", (error) => {
                 console.error("‚ùå Twilio Device Error:", error.message);
                 document.getElementById("status").innerText = "‚ùå Error: " + error.message;
             });
             try {
                 console.log("üîÑ Fetching Twilio Token...");
                 const token = await fetchToken();
                 if (!token) throw new Error("‚ùå No token received!");
 
                 device = new Twilio.Device(token, {
                     codecPreferences: ["opus", "pcmu"],
                     enableRingingState: true
                 });
 
                 device.on("ready", () => {
                     console.log("‚úÖ Twilio Device Ready");
                     document.getElementById("status").innerText = "‚úÖ Ready to make/receive calls";
                 });
 
                 device.on("incoming", (connection) => {
                     console.log("üìû Incoming Call...");
                     document.getElementById("status").innerText = "üìû Incoming Call...";
                     incomingConnection = connection;
                     document.getElementById("answerButton").style.display = "inline";
                     document.getElementById("rejectButton").style.display = "inline";
                 });
 
                 device.on("error", (error) => {
                     console.error("‚ùå Twilio Device Error:", error.message);
                     document.getElementById("status").innerText = "‚ùå Error: " + error.message;
                 });
 
             } catch (error) {
                 console.error("‚ùå Setup Error:", error);
                 document.getElementById("status").innerText = "‚ùå Error Initializing Device";
             }
         }
 
         async function requestMicAndSetupDevice() {
         async function initDeviceWithMic() {
             console.log("üîÑ Requesting microphone access...");
             try {
                 console.log("üîÑ Requesting microphone access...");
                 await navigator.mediaDevices.getUserMedia({ audio: true });
                 console.log("üé§ Microphone access granted");
                 await setupTwilioDevice();
 @@ -74,23 +80,18 @@
             }
         }
 
         document.getElementById("startButton").addEventListener("click", async () => {
             await requestMicAndSetupDevice();
         });
 
         async function answerCall() {
             await requestMicAndSetupDevice(); // Ensure mic and device are set up
         document.getElementById("startButton").addEventListener("click", initDeviceWithMic);
 
         document.getElementById("answerButton").addEventListener("click", async () => {
             await initDeviceWithMic(); // Ensure mic access and token before answering
             if (incomingConnection) {
                 console.log("‚úÖ Call Answered");
                 document.getElementById("status").innerText = "‚úÖ Call in Progress...";
                 incomingConnection.accept();
                 document.getElementById("answerButton").style.display = "none";
                 document.getElementById("rejectButton").style.display = "none";
             }
         }
 
         document.getElementById("answerButton").addEventListener("click", answerCall);
         });
 
         function rejectCall() {
             if (incomingConnection) {
 @@ -102,11 +103,8 @@
             }
         }
 
         document.getElementById("rejectButton").addEventListener("click", rejectCall);
 
         function makeCall() {
             const to = document.getElementById("callTo").value.trim();
 
             if (!to) {
                 alert("Enter a phone number to call!");
                 return;
 @@ -118,35 +116,44 @@
                 return;
             }
 
             if (to.includes("@")) {
                 alert("SIP addresses are not supported! Please enter a phone number.");
                 return;
             }
 
             let params = { To: to };
 
             console.log("üìû Calling:", params.To);
             try {
                 const connection = device.connect(params);
                 connection.on("accept", () => {
                     console.log("‚úÖ Call Connected");
                     document.getElementById("status").innerText = "‚úÖ Call Connected";
                 });
 
                 connection.on("disconnect", () => {
                     console.log("üî¥ Call Disconnected");
                     document.getElementById("status").innerText = "‚úÖ Ready to make calls";
                 });
 
                 connection.on("error", (error) => {
                     console.error("‚ùå Call Error:", error.message);
                     document.getElementById("status").innerText = "‚ùå Call Failed!";
                 });
 
             const connection = device.connect(params);
 
             connection.on("accept", () => {
                 console.log("‚úÖ Call Connected");
                 document.getElementById("status").innerText = "‚úÖ Call Connected";
             });
 
             connection.on("disconnect", () => {
                 console.log("üî¥ Call Disconnected");
                 document.getElementById("status").innerText = "‚úÖ Ready to make/receive calls";
             });
 
             connection.on("error", (error) => {
             } catch (error) {
                 console.error("‚ùå Call Error:", error.message);
                 document.getElementById("status").innerText = "‚ùå Call Failed!";
             });
             }
         }
 
         function hangUpCall() {
             if (device) {
                 device.disconnectAll();
                 console.log("üî¥ Call Ended");
                 document.getElementById("status").innerText = "‚úÖ Ready to make/receive calls";
                 document.getElementById("status").innerText = "‚úÖ Ready to make calls";
             }
         }
     </script>
 </body>
 </html>
